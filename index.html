<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Flappy Mo â€” Local Assets (v1.51-beta)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --glass:rgba(20,24,28,.80); --bg:#0b0d10; }
  * { box-sizing: border-box; }
  html,body{ margin:0; height:100%; background:var(--bg); overflow:hidden; }
  body{ font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial; -webkit-user-select:none; user-select:none; -webkit-tap-highlight-color:transparent; }

  #game{
    position:fixed; top:50%; left:50%;
    width:1920px; height:1080px;
    transform:translate(-50%, -50%) scale(1);
    transform-origin:center center;
    background:#000; touch-action:none; image-rendering:auto;
    border-radius:14px; border:1px solid rgba(255,255,255,.08);
    box-shadow:0 18px 50px rgba(0,0,0,.45);
  }

  .overlay{ position:fixed; inset:0; display:grid; place-items:center; pointer-events:none; z-index:10; padding:16px; }
  .card{
    pointer-events:auto; color:#fff; background:var(--glass);
    border:1px solid rgba(255,255,255,.08); border-radius:14px;
    padding:20px 22px; text-align:center; backdrop-filter:blur(6px);
    box-shadow:0 10px 30px rgba(0,0,0,.5);
    max-width:min(92vw,560px); max-height:calc(100vh - 64px);
    overflow:auto; -webkit-overflow-scrolling:touch; touch-action:pan-y;
    cursor:pointer;
  }
  .card h1{ margin:0 0 8px; font-size:clamp(20px,4vw,34px); font-weight:800 }
  .hud{ position:fixed; top:10px; left:50%; transform:translateX(-50%); display:flex; gap:12px; pointer-events:none; z-index:12 }
  .badge{ background:var(--glass); border-radius:10px; padding:4px 10px; color:#fff; font-weight:700; font-size:14px; min-width:84px; text-align:center; border:1px solid rgba(255,255,255,.1) }

  .rot-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.78); color:#fff; display:none; align-items:center; justify-content:center; text-align:center; z-index:999 }
  .rot-overlay.show{ display:flex }
  .rot-box{ max-width:90vw; border:1px solid rgba(255,255,255,.15); border-radius:14px; padding:22px; background:rgba(20,24,28,.85) }

  .mute-btn, .fs-btn{ position:fixed; z-index:13; pointer-events:auto; background:var(--glass); color:#fff; border:1px solid rgba(255,255,255,.15); border-radius:10px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer; }
  .mute-btn{ right:12px; top:12px; }
  .fs-btn{ right:12px; bottom:12px; }

  #loadingOverlay{
    position:fixed; inset:0; display:grid; place-items:center;
    background:#0b0d10; color:#fff; z-index:2000;
    font-weight:800; font-size:18px;
  }
</style>
</head>
<body>

<canvas id="game" width="1920" height="1080"></canvas>

<!-- HUD -->
<div class="hud">
  <div class="badge">Score: <span id="scoreVal">0</span></div>
  <div class="badge">Last:  <span id="lastVal">0</span></div>
  <div class="badge">Best:  <span id="bestVal">0</span></div>
</div>
<button id="muteBtn" class="mute-btn" aria-pressed="false">ðŸ”Š Sound</button>
<button id="fsBtn" class="fs-btn">â›¶ Fullscreen</button>

<!-- Overlays -->
<div class="overlay">
  <div id="startCard" class="card">
    <h1>Tap to Start</h1>
    <p>Tap again to flap â€¢ Best is saved</p>
  </div>

  <div id="gameOverCard" class="card hidden" style="align-self:flex-start; margin-top:20px;">
    <h1>Game Over</h1>
    <p id="finalScoreP">Score: 0 â€¢ Best: 0</p>
    <p style="opacity:.85;font-size:12px;margin-top:8px">Tap outside to restart (after 1s)</p>
  </div>
</div>

<div id="rotBlock" class="rot-overlay">
  <div class="rot-box"><h2>Rotate your device</h2><p>This game is landscape-only.</p></div>
</div>

<div id="loadingOverlay">Loadingâ€¦</div>

<script>
(() => {
  const VERSION = '1.51-beta';
  const WORLD_W=1920, WORLD_H=1080;
  const SPEED_MULT = 1.5;
  const G=4800*SPEED_MULT, LIFT=-1350*SPEED_MULT, MAX_FALL=2200*SPEED_MULT, PIPE_SPEED=480*SPEED_MULT;
  const PIPE_W=180, GAP_MIN=310, GAP_MAX=450;
  const SWITCH_MIN_GAP_X = WORLD_W*0.5, HSEQ_SPACING=WORLD_W*0.25;

  const canvas=document.getElementById('game'), ctx=canvas.getContext('2d',{alpha:false});
  let bgImg=null, birdImg=null;

  const obstacles=[];
  const bird={x:WORLD_W*0.167,y:WORLD_H*0.5,w:75,h:75,v:0,draw(){ctx.save();ctx.translate(this.x+this.w/2,this.y+this.h/2);ctx.rotate(this.v/2000);ctx.drawImage(birdImg||this.fallback,-this.w/2,-this.h/2,this.w,this.h);ctx.restore();},step(dt){this.v+=G*dt;this.v=Math.min(this.v,MAX_FALL);this.y+=this.v*dt;},flap(){this.v=LIFT;},reset(){this.y=WORLD_H/2;this.v=0;},fallback:(()=>{const c=document.createElement('canvas');c.width=64;c.height=64;const g=c.getContext('2d');g.fillStyle='#fff';g.fillRect(0,0,64,64);return c;})()};

  function spawnVPipe(){const gap=Math.random()*(GAP_MAX-GAP_MIN)+GAP_MIN;const top=Math.random()*(WORLD_H-gap-200)+100;obstacles.push({type:'v',x:WORLD_W,w:PIPE_W,top, gap,scored:false});}
  function spawnHBar(startX){const length=WORLD_W*0.6;const y=Math.random()*(WORLD_H-300)+150;obstacles.push({type:'h',x:startX||WORLD_W,y,length,h:PIPE_W,scored:false});}

  function drawBG(){ctx.fillStyle='#d9f4ff';ctx.fillRect(0,0,WORLD_W,WORLD_H);}
  function drawObs(){for(const o of obstacles){if(o.type==='v'){ctx.fillStyle='#2e8b57';ctx.fillRect(o.x,0,o.w,o.top);ctx.fillRect(o.x,o.top+o.gap,o.w,WORLD_H-(o.top+o.gap));}else{ctx.fillStyle='#8b5e3c';ctx.fillRect(o.x,o.y,o.length,o.h);}}}

  let score=0,last=0,best=0,started=false,over=false;
  function startGame(){score=0;obstacles.length=0;bird.reset();spawnHBar(WORLD_W+200);spawnHBar(WORLD_W+200+HSEQ_SPACING);spawnHBar(WORLD_W+200+HSEQ_SPACING*2);started=true;over=false;}
  function endGame(){over=true;document.getElementById('finalScoreP').textContent=`Score: ${score} â€¢ Best: ${best}`;document.getElementById('gameOverCard').classList.remove('hidden');}
  document.getElementById('startCard').onclick=()=>{if(!started){startGame();bird.flap();}else if(!over){bird.flap();}};
  document.addEventListener('keydown',()=>{if(!started){startGame();bird.flap();}else if(!over){bird.flap();}});

  let lastTs=performance.now();
  function loop(ts){const dt=(ts-lastTs)/1000;lastTs=ts;if(started&&!over){for(const o of obstacles){o.x-=PIPE_SPEED*dt;if(o.type==='v'&&!o.scored&&o.x+o.w<bird.x){score++;o.scored=true;best=Math.max(best,score);}if(o.type==='h'&&!o.scored&&o.x+o.length<bird.x){score++;o.scored=true;best=Math.max(best,score);}}bird.step(dt);if(bird.y>WORLD_H)endGame();}
    ctx.clearRect(0,0,WORLD_W,WORLD_H);drawBG();drawObs();bird.draw();
    ctx.fillStyle='#000';ctx.font='700 16px Montserrat';ctx.fillText('v'+VERSION,14,WORLD_H-14);
    requestAnimationFrame(loop);}
  bgImg=null;birdImg=null;document.getElementById('loadingOverlay').style.display='none';requestAnimationFrame(loop);
})();
</script>
</body>
</html>
