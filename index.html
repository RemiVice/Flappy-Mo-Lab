<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Flappy Mo â€” Local Assets (v1.45-smooth60)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --glass:rgba(20,24,28,.80); --bg:#0b0d10; }
  * { box-sizing: border-box; }
  html,body{ margin:0; height:100%; background:var(--bg); overflow:hidden; }
  body{ font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial; -webkit-user-select:none; user-select:none; }
  canvas{ display:block; width:100%; height:100%; background:#000; }

  /* Overlay UI */
  #overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    flex-direction:column; color:#fff; text-align:center; z-index:5; pointer-events:none;
  }
  #overlay.hidden{ display:none; }

  #gameover{
    background:var(--glass); padding:20px; border-radius:16px;
    backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
    max-width:90%; text-align:center; pointer-events:auto;
  }
  #gameover h1{ font-size:2em; margin:0 0 10px; }
  #gameover p{ margin:6px 0; }
  #restartBtn{
    margin-top:12px; padding:10px 20px; border:none; border-radius:12px;
    background:#ff4757; color:#fff; font-size:1em; font-weight:700; cursor:pointer;
  }
  #restartBtn:hover{ background:#ff6b81; }

  #loading{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-size:1.2em; color:#aaa; background:#000; z-index:10; }
  #loading.hidden{ display:none; }

  #version{
    position:absolute; bottom:6px; right:10px; font-size:12px; color:#888;
    font-weight:500; pointer-events:none;
  }
</style>
</head>
<body>
<div id="loading">Loading...</div>
<canvas id="gameCanvas"></canvas>

<div id="overlay" class="hidden">
  <div id="gameover">
    <h1>Game Over</h1>
    <p id="finalScore"></p>
    <p id="systemInfo"></p>
    <button id="restartBtn">Restart</button>
  </div>
</div>

<div id="version">v1.45-smooth60</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");
const finalScoreEl = document.getElementById("finalScore");
const systemInfoEl = document.getElementById("systemInfo");
const restartBtn = document.getElementById("restartBtn");
const loading = document.getElementById("loading");

let w,h; 
function resize(){ w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight; }
resize(); window.addEventListener("resize",resize);

// --- GAME VARIABLES ---
let bird, pipes, frame, score, best=0, gameOver, gameStarted=false;
const gravity = 0.5, jump = -8, pipeGap=160, pipeWidth=70, pipeSpeed=3;

// --- BIRD ---
function resetBird(){ bird={ x:80, y:h/2, vy:0, r:20 }; }

// --- RESET GAME ---
function resetGame(){
  resetBird();
  pipes=[];
  frame=0; score=0;
  gameOver=false;
  gameStarted=true;
  overlay.classList.add("hidden");
}

// --- PIPE GENERATION ---
function addPipe(){
  let top = Math.random()*(h/2);
  pipes.push({ x:w, top:top, bottom:top+pipeGap });
}

// --- COLLISION CHECK ---
function checkCollision(b,p){
  if(b.x+b.r>p.x && b.x-b.r<p.x+pipeWidth){
    if(b.y-b.r<p.top || b.y+b.r>p.bottom){ return true; }
  }
  return false;
}

// --- GAME LOOP ---
function update(){
  if(!gameStarted || gameOver) return;

  frame++;
  bird.vy+=gravity;
  bird.y+=bird.vy;

  if(frame%100===0) addPipe();

  for(let i=0;i<pipes.length;i++){
    let p=pipes[i];
    p.x-=pipeSpeed;

    if(checkCollision(bird,p)){ triggerGameOver(); }
    if(p.x+pipeWidth<bird.x && !p.passed){
      score++; p.passed=true;
      if(score>best) best=score;
    }
  }
  pipes=pipes.filter(p=>p.x+pipeWidth>0);

  if(bird.y>h || bird.y<0){ triggerGameOver(); }
}

// --- DRAW ---
function draw(){
  ctx.fillStyle="#0b0d10"; ctx.fillRect(0,0,w,h);

  // Bird
  ctx.fillStyle="#ff0";
  ctx.beginPath(); ctx.arc(bird.x,bird.y,bird.r,0,Math.PI*2); ctx.fill();

  // Pipes
  ctx.fillStyle="#0f0";
  for(let p of pipes){
    ctx.fillRect(p.x,0,pipeWidth,p.top);
    ctx.fillRect(p.x,p.bottom,pipeWidth,h-p.bottom);
  }

  // Score
  ctx.fillStyle="#fff";
  ctx.font="700 32px Montserrat";
  ctx.fillText(score,w/2-ctx.measureText(score).width/2,80);
}

// --- MAIN LOOP ---
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// --- INPUT ---
function flap(){
  if(gameOver){
    // ignore taps when game over overlay is visible
    return;
  }
  if(!gameStarted){ resetGame(); }
  bird.vy=jump;
}
window.addEventListener("pointerdown", flap);
window.addEventListener("keydown", e=>{ if(e.code==="Space") flap(); });

// --- GAME OVER ---
function triggerGameOver(){
  gameOver=true;
  gameStarted=false;
  finalScoreEl.textContent = `Score: ${score} | Best: ${best}`;
  systemInfoEl.textContent = `Screen: ${w}x${h} | Refresh ~${Math.round(1000/60)}Hz`;
  overlay.classList.remove("hidden");
}

// --- RESTART BUTTON ---
restartBtn.addEventListener("click",()=>{ resetGame(); });

// --- START ---
function start(){
  resetGame();
  loading.classList.add("hidden"); // hide loading once ready
  loop();
}
start();
</script>
</body>
</html>
